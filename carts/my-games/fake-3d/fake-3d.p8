pico-8 cartridge // http://www.pico-8.com
version 41
__lua__
-- main
function _init()
	objs={}
	tilt_angle=0
	gravity=1
	game_start()
end

function _update()
	cls()
	for o in all(objs) do
	end
	tilt_angle=0
	if btn(⬅️) then
		rotate_cam(1/180)
	end
	if btn(➡️) then
		rotate_cam(-1/180)
	end
	if btn(⬆️) then
		for o in all(objs) do
			o.y-=1
			tilt(o,10)
		end
	end
	if btn(⬇️) then
		for o in all(objs) do
			o.y+=1
			tilt(o,-10)
		end
	end
end

function _draw()
	-- sort by depth
	qsort(objs,
		function(a,b) return a.y<b.y end)
	-- draw the shadow first
	for o in all(objs) do
		--circfill(o.x,o.y,o.r,5)
		ovalfill(o.x-o.r,o.scr_y-o.r/3,
			o.x+o.r,o.scr_y+o.r/3,5)
	end
	-- draw the objects
	for o in all(objs) do
		circfill(o.x,o.scr_y-o.scr_h,o.r,o.c)
	end
end
-->8
-- game inits
function game_start()
	for i=0,20 do
		local x=68+(rnd(100)-50)
		local y=68+(rnd(100)-50)
		local h=rnd(20)
		local r=rnd(5)+2
		local c=rnd({7,8,9,10})
		
		make_obj(x,y,h,r,c)
	end
end
-->8
-- updates
-->8
-- draw
-->8
-- tools
function make_obj(x,y,h,r,c)
	add(objs,{
		x=x,
		y=y,
		h=h,
		scr_y=y,
		scr_h=h,
		depth=r,
		r=r,
		c=c,
	})
end

-- a: array to be sorted in-place
-- c: comparator (optional, defaults to ascending)
-- l: first index to be sorted (optional, defaults to 1)
-- r: last index to be sorted (optional, defaults to #a)
function qsort(a,c,l,r)
 c,l,r=c or ascending,l or 1,r or #a
 if l<r then
  if c(a[r],a[l]) then
   a[l],a[r]=a[r],a[l]
  end
  local lp,rp,k,p,q=l+1,r-1,l+1,a[l],a[r]
  while k<=rp do
   if c(a[k],p) then
    a[k],a[lp]=a[lp],a[k]
    lp+=1
   elseif not c(a[k],q) then
    while c(q,a[rp]) and k<rp do
     rp-=1
    end
     a[k],a[rp]=a[rp],a[k]
     rp-=1
     if c(a[k],p) then
      a[k],a[lp]=a[lp],a[k]
      lp+=1
     end
   end
   k+=1
  end
  lp-=1
  rp+=1
  a[l],a[lp]=a[lp],a[l]
  a[r],a[rp]=a[rp],a[r]
  qsort(a,c,l,lp-1       )
  qsort(a,c,  lp+1,rp-1  )
  qsort(a,c,       rp+1,r)
 end
end

function rotate_vector(x,y,dx,dy,angle)
	x_rotated=((x-dx)*cos(angle))
		-((y-dy)*sin(angle))+dx
	y_rotated=((x-dx)*sin(angle))
	 +((y-dy)*cos(angle))+dy
	return {
		rx=x_rotated,
		ry=y_rotated
	}
end
-- rotate camera related to center
-- of the screen (64,64)
function rotate_cam(angle)
	for o in all(objs) do
		local dx=64
		local dy=64
		local x_r=((o.x-dx)*cos(angle))
			-((o.y-dy)*sin(angle))+dx
		local y_r=((o.x-dx)*sin(angle))
		 +((o.y-dy)*cos(angle))+dy
		o.x=x_r
		o.y=y_r
		tilt(o,tilt_angle)
	end
end

function tilt(o,ang)
	--if ang>0 then
		o.scr_y+=(64-o.y)/ang
	--else
		--o.scr_y+=(o.y-64)/ang
	--end
	o.scr_h+=o.h/ang
end
__gfx__
0000000000022000000220000002200000099000000000000000000000000000000000000000000000000000088008800880088000ff880000ff880000000000
000000000028820000288200002882000097790000077000000770000007700000c77c000007700000000000888888888008800808888880088888800cccccc0
00700700002882000028820000288200009aa90000c77c000007700000c77c000cccccc000c77c0000000000888888888000000806555560076665500c7777c0
0007700000288e2002e88e2002e88200009aa90000cccc00000cc00000cccc0000cccc0000cccc0000000000888888888000000865666655765555650cccccc0
0007700002ac88202e8ac8e20288ac20009aa900000cc000000cc000000cc00000000000000cc00000000000088888800800008057655576555776550c7cc7c0
00700700021188202881188202881120009aa90000000000000cc00000000000000000000000000000000000008888000080080006557660057655500c7777c0
000000000255882028d55d8202885520009aa9000000000000000000000000000000000000000000000000000008800000088000005765000065570000c77c00
000000000029920002d99d20002992000009900000000000000000000000000000000000000000000000000000000000000000000006500000057000000cc000
00000000033003300300330003300330003300300058950000089500001891000059800020000002020000200000550000005000000500000055000000000000
0000000033b33b330b3b333033b33b330333b3b00521125000d212500011110005212d0022000022220000220005500000055000000550000005500000cccc00
000000003bbbbbb30bbbb3303bbbbbb3033bbbb0521aa1250251a12000155100021a152022222222222222220555555005555550055555500555555000c77c00
000000003b7717b30b71b3303b7717b3033b71b0621aa1260d51a12000d55d00021a15d028222282282222822222222222222222222222222222222200cccc00
000000000b7117b00b11b3000b7117b0003b11b06520025606520250006dd6000520256028888882288888822606060226060602266666622606060200c7cc00
00000000003773000077300000377300000377000650056000650560006666000650560028788782287887822000000220606062222222202060606200c77c00
00000000030330300300030003033030003000300760067000760d000006600000d0670028888882080000802060606222222220000000002222222000c77c00
000000003000000303303300300000030033033000700700000706000007700000607000080000800000000022222220000000000000000000000000000cc000
00000000000000000000000000000000000000000000000000000000000000000007000000000000000000000000000000000000000808000000800000000000
0000000000000000000000000000000000000000000bb000000bb0000007700000077000000000000000000000000000000000000088888000088800000cc000
000000000000149aa9410000000001222210000000666600006666006066660660666606000000000000000000000000000000000088888000088800000c7000
0000000000019777aa921000000029aaaa9200000566665065666656b566665bb566665b099009900099090000099000009099000088888000088800000cc000
000000000d09a77a949920d00d0497777aa920d065637656b563765b0563765005637650099009900099090000099000009099000088888000088800000c7000
000000000619aaa9422441600619a77944294160b063360b006336000063360000633600000000000000000000000000000000000008880000088800000c7000
0000000007149a922249417006149a944224416000633600006336000063360000633600000000000000000000000000000000000000800000008000000c7000
0000000007d249aaa9942d7006d249aa99442d60000660000006600000066000000660000000000000000000000000000000000000000000000000000000c000
00000000067d22444422d760077d22244222d7700000000000000000000000000099990000000000000000000000000000000000000000000000000000000000
000000000d666224422666d00d776249942677d000222200008888000033330009aaaa9000099000000090000009000000090000000000000000000000000000
00000000066d51499415d66001d1529749251d100244442008eeee8003bbbb309aa77aa9000990000000900000090000000900000000d800008d000000000000
000000000041519749151400066151944a1516600248842008eaae8003baab309a7777a900000000000000000000000000000000001d10000001d10000000000
0000000000a001944a100a0000400149a41004000248842008eaae8003baab309a7777a900000000000000000000000000000000011111000011111000000000
0000000000000049a400090000a0000000000a000244442008eeee8003bbbb309aa77aa909900990009909000009900000909900016111000016111000000000
000000000000000000000000000000000000090000222200008888000033330009aaaa9009900990009909000009900000909900016111000016111000000000
00000000000000000000000000000000000000000000000000000000000000000099990000000000000000000000000000000000001110000001110000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ccccccccccccccccccccccc000000000
0000000000000007a00000000000000000000000000000000000000000000000000000000000000000000000000000000c000000000000000000000c00000000
0000000070000007a0000007000000000000000000700007a0000700000000000000000000000007a0000000000000000c000000000000000000000c00000000
000000007700037aa9300077000000000000000007700007a0000770000000000000000070000007a0000007000000000c000000000000000000000c00000000
00000000a77733aa9933777a00000000000000000770037aa930077000000000000000007700037aa9300077000000000c000000000000000000000c00000000
000000009aaa3b3993b3aaa900000000000000009a7733aa993377a90000000000000000a77733aa9933777a000000000c000000000000000000000c00000000
0000000b3993bbb33bbb3993b00000000000000039aa3b3993b3aa9300000000000000009aaa3b3993b3aaa900000000ccccccccccccccccccccccc000000000
000000bbb33bb3b33b3bb33bbb0000000000000b3333bbb33bbb333bb00000000000000b3993bbbbbbbb3993b000000000000000000000000000000000000000
00000bb7bbbb373ff3b3bbbb3bb00000000000bbbbbbb3b33b3bbbbbbb000000000000bbb33bb7bb3bbbb33bbb00000088888888888888888888888000000000
0000bb77bbbb373ff3b3bbb333bb000000000bb73bbb373ff3b3bbb33bb0000000000bb7bbbb77bb3bbbbbbb3bb0000008000000000000000000000800000000
000bb77333b3a377f93b3b333bbbb0000000bb7733bb373ff3b3bb333bbb00000000bb77bbb77bb33bbbbbb333bb000008000000000000000000000800000000
000b777b3333a377193b3333bb33b000000bb77b3333a377f93b3333bbbbb000000bb77333bb7bb33bbbbb333bbbb00008000000000000000000000800000000
00bb777bbbb3a3f1091b3bbbb333bb00000b77bbb333a377193b333bb333b000000b777b3333bbb33bbb3333bb33b00008000000000000000000000800000000
00bb77aabbbbb390091bbbbb3333bb0000bb7733bbb3a3f1091b3bbb3333bb0000bb777bbb3333b33b3333bbb333bb0008000000000000000000000800000000
007bbaaa333bb1999e1bb333333bbb0000bb773333bbb390091bbb333333bb0000bb77aabbbbbbb33bbbbbb33333bb0088888888888888888888888000000000
0007bbbbbb333b13e1b333bbbbbbb000007bbaa33333b1999e1b3333333bbb00007bbaaa33333bb33bbb3333333bbb0000000000000000000000000000000000
000000311177b311113b7711130000000007bbbbbb333b13e1b333bbbbbbb000000bbbbbbb333b1e31b333bbbbbb700000000000000000000000000000000000
00333003311111111111111330033300000000311177b311113b771113000000000000311177b311113b77111300000000000000000000000000000000000000
0b3333008383344184433838003333b0000000033111111111111113300000000000000331111111111111133000000000000000000000000000000000000000
02bbb3322828884884888282233bbb20000000008383344184433838000000000000000083833448144338380000000000000000000000000000000000000000
00222220022989800898922002222200000033322828884884888282233300000000333228288848848882822333000000000000000000000000000000000000
00000000002a9a0000a9a20000000000000333b202298980089892202b333000000333b202298980089892202b33300000000000000000000000000000000000
0000000333207a0000a702333000000000033b0000209a7007a9a20000b3300000033b00002a9a7007a9020000b3300000000000000000000000000000000000
00000333320027700772002333300000000bb20003202a7707a20230002bb000000bb20003202a7077a20230002bb00000000000000000000000000000000000
0000333b2002220000222002b3330000000000003320082202280033000000000000000033008220228002330000000000000000000000000000000000000000
000333b200082200002280002b333000000000033000008008800003300000000000000330000880080000033000000000000000000000000000000000000000
000bbb20000088000088000002bbb000000000332000000000000002330000000000003320000000000000023300000000000000000000000000000000000000
00002200000000000000000000220000000000332200000000000022330000000000003322000000000000223300000000000000000000000000000000000000
00000000000000000000000000000000000000332200000000000022330000000000003322000000000000223300000000000000000000000000000000000000
00000000000000000000000000000000000000332200000000000022330000000000003322000000000000223300000000000000000000000000000000000000
00000000000000000000000000000000000000022000000000000002200000000000000220000000000000022000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
08888888800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
80000000088888888888888888888888000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
80080080088000000000000000000000800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
80888888088088808880888088808880880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
80888888088088808880888088808880880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
80088880088088808880888088808880880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
80008800088088808880888088808880880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
80000000088000000000000000000000800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
08888888888888888888888888888888000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0ccccccccccccccccccccccccccccccc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
c00000000cc000000000000000000000c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
c00c00c00cc0c0c0c0c0c0c0c0c0c0c0cc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
c00cccc00cc0c0c0c0c0c0c0c0c0c0c0cc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
c00c77c00cc0c0c0c0c0c0c0c0c0c0c0cc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
c00c77c00cc0c0c0c0c0c0c0c0c0c0c0cc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
c000cc000cc000000000000000000000c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
c00000000ccccccccccccccccccccccc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0cccccccc00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
0001000031510305102c51027510215101b510155100c500045000050000500015000250000500005000050000500005000050000500015000050000500005000050000500005000050000500015000050000500
000200001a6101a6101961019610186101661014610126100f6100d6100a610076100561003610026100161000610006100160000000000000000000000000000000000000000000000000000000000000000000
000100001a5201552012520105200f5200d5200a52009520085200250001500005000550006500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001e000016510165301650016500165401654016500165001f5401f5401f5001f5001f5401f5401f5001f5002e5402e5402e5002e5002e5402e5402e5002e5002454024540245002450024530245202450024500
001e000007100071000712007120071000710007120071200c1000c1000c1200c1200c1000c1000c1200c1200a1000a1000a1200a1200a1000a1000a1200a1200310003100031200312003100031000312003120
001e0000077100772007730077300772007710077100772013730137301373013730137201371013710137200f7300f7300f7300f7300f7200f7100f7100f7201873018730187301873018720187101871018720
001e000024320243202b30027320243200030022320003001f3200030018320003001f320223002a30018300183201832018300273202e3202e3001632016320323200c320163201d32030320273000330005300
290500003c5523a51236522325322f5422c5422854225542215421f5421b542195421653213532105320e5320b522095220752205522035220152200522055020450204502035020350202502005020050200502
34030000006011263111631106310f6210c6210a62108621056210261100601026010560100601006010060100601006010060100601006010060100601006010060100601006010060100601006010060100601
5d02000010355003050b3550735502355013550000500005000050000500005000050000500005000050000500005000050000500005000050000500005000050000500005000050000500005000050000500005
900300002041323413244132441300413004130142326423274332743327443004430145302453294032b4032c4030040301403034032d4032d4032e4032f403014030240304403064032f403304033140300403
760400000060200602006020060200602006020161202612026120361204612056220662208622096220b6220d6320e632116321363216642186421b6421c6421e642216522365226652286422b6322f63233622
1b04000000505015550355506555075550a5550f555185552755534555225050c5050d5050f505105051350515505005050050500505005050050500505005050050500505005050050500505005050050500505
900800000c0170f0371107714077180371f02723017280271d0072d0073b0073c0070000700007000070000700007000070000700007000070000700007000070000700007000070000700007000070000700007
3a020000276502b670306703466034640326302e6302b630286302562020620156201661015610106100a610066100c6000860008600086000660006600056000460003600036000260001600016000160001600
220200000f2130f2130f2131c203182030d2030d2030d2031021310213102130c2030c2030c203002030020300203002030020300203002030020300203002030020300203002030020300203002030020300203
b60300001a60721617296372e64731657326570060700607006070060700607006070060700607006070060700607006070060700607006070060700607006070060700607006070060700607006070060700607
2001000003110041100d1100f1100a110001000010000100001003210000100001000010000100001000010000100001000010000100001000010000100001000010000100001000010000100001000010000100
020200000050314513215232b533315333253312523095130b5030050300503005030050300503005030050300503005030050300503005030050300503005030050300503005030050300503005030050300503
010400000060518655186551865518605186051860518605186050060500605006051865518655186551860518605186051860518605186050060500605006051865518655186551860518605186051860518605
4c030000136111c61123611286112b6112f6113261133611346113461133611316112f6112d6112b611286112661123611206111c6111961116611146110f6110c6110a611056110461103611026110160100601
__music__
02 03040506

